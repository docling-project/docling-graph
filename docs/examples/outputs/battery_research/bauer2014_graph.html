<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Graph Visualization - Cytoscape</title>

    <!-- Cytoscape core -->
    <script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>

    <!-- Dagre layout extension (optional but more reliable) -->
    <script src="https://unpkg.com/dagre@0.8.5/dist/dagre.min.js"></script>
    <script src="https://unpkg.com/cytoscape-dagre@2.5.0/cytoscape-dagre.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Inter", -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: #17191d;
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
        }

        #cy {
            width: 100%;
            height: 100vh;
            background: #343b46; /* --cosmos-background */
            box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.5);
        }

        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(34, 35, 37, 0.95); /* --sidebar-background */
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            z-index: 1000;
            min-width: 200px;
            color: #ffffff;
        }

        /* Combined rule for both titles */
        .controls h3, .stats h3 {
            margin: 0 0 12px 0;
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
            border-bottom: 2px solid #76b7b2; /* Palette color */
            padding-bottom: 8px;
        }

        .control-group {
            margin: 10px 0;
        }

        .control-group label {
            display: block;
            font-size: 13px;
            color: #e2e8f0;
            margin-bottom: 6px;
            font-weight: 500;
        }

        select, button {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #4a5568;
            border-radius: 6px;
            font-size: 13px;
            background: #2f3032; /* --table-background */
            color: #ffffff;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        select:hover, select:focus {
            border-color: #76b7b2;
            outline: none;
        }

        .control-group button {
            background: #76b7b2;
            color: #17191d;
            border: none;
            font-weight: 600;
            margin-top: 5px;
        }

        .control-group button:hover {
            box-shadow: 0 4px 12px rgba(118, 183, 178, 0.3);
        }

        .control-group button:active {
            transform: translateY(0);
        }

        .info-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(34, 35, 37, 0.95); /* --sidebar-background */
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            z-index: 1000;
            min-width: 250px;
            max-width: 400px;
            display: none;
            max-height: 60vh;
            overflow-y: auto;
            color: #ffffff;
        }

        .info-panel.active {
            display: block;
        }

        .info-item {
            margin: 6px 0;
            font-size: 13px;
            color: #e2e8f0;
            word-wrap: break-word;
        }

        .info-label {
            font-weight: 600;
            color: #76b7b2; /* Palette color */
        }

        .stats {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(34, 35, 37, 0.95); /* --sidebar-background */
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            z-index: 1000;
            font-size: 13px;
            color: #ffffff;
            max-width: 300px;
        }

        .stats strong {
            color: #76b7b2; /* Palette color */
        }

        
        .stats .info-label {
            margin-bottom: 4px;
        }

        .info-count {
            font-size: 12px;
            color: #e2e8f0;
        }

        .node-types {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #4a5568;
            color: #76b7b2;
        }

        .node-types-title {
            color: #76b7b2;
            margin-bottom: 8px;
        }

        .node-type-item {
            margin-left: 10px;
            font-size: 12px;
            color: #e2e8f0;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(34, 35, 37, 0.95);
            padding: 30px 50px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            font-size: 18px;
            color: #ffffff;
            z-index: 2000;
            display: none;
        }

        .loading.active {
            display: block;
        }
    </style>
</head>
<body>
    <div id="cy"></div>

    <div class="loading" id="loading">
        <div>‚è≥ Loading Graph...</div>
    </div>

    <div class="stats">
        <!-- Title for the stats panel -->
        <h3>ü™ß Information</h3>
        <div class="summary">
            <div class="info-label"><strong>Nodes:</strong> <span class="info-count" id="node-count">0</span></div>
            <div class="info-label"><strong>Edges:</strong> <span class="info-count" id="edge-count">0</span></div>
        </div>
        <div class="node-types">
            <div class="node-types-title"><strong>Node types:</strong></div>
            <div id="node-types-list"></div>
        </div>
    </div>

    <div class="info-panel" id="info-panel">
        <div id="info-content"></div>
    </div>

    <div class="controls">
        <h3>‚öôÔ∏è Controls</h3>

        <div class="control-group">
            <label for="layout-select">Layout Algorithm</label>
            <select id="layout-select">
                <option value="dagre">Hierarchical (Dagre)</option>
                <option value="cose">Force-directed (CoSE)</option>
                <option value="circle">Circle</option>
                <option value="grid">Grid</option>
                <option value="breadthfirst">Breadth-first</option>
                <option value="concentric">Concentric</option>
            </select>
        </div>

        <div class="control-group">
            <button id="reset-btn">Reset View</button>
        </div>
    </div>

    <script>
        const graphElements = {
  "nodes": [
    {
      "data": {
        "id": "Research_a51e0d94f6fd",
        "label": "Research",
        "type": "entity",
        "title": "Rheological properties and stability of NMP based cathode slurries for lithium ion batteries"
      }
    },
    {
      "data": {
        "id": "Extraction_d19c67115651",
        "label": "Extraction",
        "type": "entity",
        "experiment_id": "EXP2013-001",
        "objective": "Compare the colloidal stability of various NMP based cathode slurries by means of rheological testing.",
        "hypothesis": "The addition of a high molecular weight PVDF binder is sufficient to establish gel formation by bridging flocculation in case of the nanoscaled cathode material.",
        "conclusion": "The addition of a PVDF binder with sufficient long chain length was found to cause gel formation in NMP by bridging flocculation for nanoscaled LFP powder. For micron-sized NMC particles, the addition of nanosized carbon black was necessary to provide attraction between the NMC particles by formation of a particulate gel.",
        "key_findings": "['The addition of a high molecular weight PVDF binder is sufficient to establish gel formation by bridging flocculation in case of the nanoscaled cathode material.', 'For the larger micron-scaled particles, the formation of a stable coagulated state is also feasible but it requires the combination of a particulate CB gel and a strengthening PVDF polymer network.', 'The micron-sized NMC particles in association with the comparably small binder molecules did not allow a creation of a stable polymer gel structure.', 'The addition of nanosized carbon black was necessary to provide attraction between the NMC particles by formation of a particulate gel.']",
        "limitations": "Additives, like binder or carbon black, are chosen and optimized predominantly for their impact on the electrochemical properties of the electrode."
      }
    },
    {
      "data": {
        "id": "Slurry_bdd079028ce8",
        "label": "Slurry",
        "type": "entity",
        "slurry_id": "SLURRY2013-001"
      }
    },
    {
      "data": {
        "id": "Component_1053de12e699",
        "label": "Component",
        "type": "entity",
        "role": "Active Material"
      }
    },
    {
      "data": {
        "id": "Material_54ace0a45fc0",
        "label": "Material",
        "type": "entity",
        "name": "LiFePO4",
        "category": "Olivine Phosphate",
        "chemical_formula": "LiFePO4"
      }
    },
    {
      "data": {
        "id": "MaterialProperty_ef8bb32df99b",
        "label": "MaterialProperty",
        "type": "entity",
        "name": "Median Particle Size",
        "numeric_value": 130.0,
        "unit": "nm"
      }
    },
    {
      "data": {
        "id": "MaterialProperty_ca16de11dfea",
        "label": "MaterialProperty",
        "type": "entity",
        "name": "Specific Surface Area",
        "numeric_value": 16.0,
        "unit": "m¬≤/g"
      }
    },
    {
      "data": {
        "id": "MaterialProperty_a37aa557c0fa",
        "label": "MaterialProperty",
        "type": "entity",
        "name": "Density",
        "numeric_value": 3.46,
        "unit": "g/cm¬≥"
      }
    },
    {
      "data": {
        "id": "ComponentAmount_df05aab6a051",
        "label": "ComponentAmount",
        "type": "entity",
        "name": "Volume Fraction",
        "numeric_value": 20.0,
        "unit": "vol%"
      }
    },
    {
      "data": {
        "id": "Component_f0bd877e9fd7",
        "label": "Component",
        "type": "entity",
        "role": "Active Material"
      }
    },
    {
      "data": {
        "id": "Material_edee1c86eb79",
        "label": "Material",
        "type": "entity",
        "name": "Li(Ni1/3Mn1/3Co1/3)O2",
        "category": "Lithium Nickel Manganese Cobalt Oxide",
        "chemical_formula": "Li(Ni1/3Mn1/3Co1/3)O2"
      }
    },
    {
      "data": {
        "id": "MaterialProperty_fe980c39629e",
        "label": "MaterialProperty",
        "type": "entity",
        "name": "Mean Particle Size",
        "numeric_value": 8.9,
        "unit": "¬µm"
      }
    },
    {
      "data": {
        "id": "MaterialProperty_b5aa0099fd4e",
        "label": "MaterialProperty",
        "type": "entity",
        "name": "Specific Surface Area",
        "numeric_value": 0.4,
        "unit": "m¬≤/g"
      }
    },
    {
      "data": {
        "id": "MaterialProperty_a81d5a3454b1",
        "label": "MaterialProperty",
        "type": "entity",
        "name": "Density",
        "numeric_value": 4.63,
        "unit": "g/cm¬≥"
      }
    },
    {
      "data": {
        "id": "Component_93ebc76b3037",
        "label": "Component",
        "type": "entity",
        "role": "Binder"
      }
    },
    {
      "data": {
        "id": "Material_baff62f33661",
        "label": "Material",
        "type": "entity",
        "name": "Polyvinylidene Fluoride",
        "category": "Fluoropolymer",
        "chemical_formula": "(C2H2F2)n"
      }
    },
    {
      "data": {
        "id": "MaterialProperty_7313bdb1d9bc",
        "label": "MaterialProperty",
        "type": "entity",
        "name": "Molecular Weight",
        "numeric_value": 370000.0,
        "unit": "g/mol"
      }
    },
    {
      "data": {
        "id": "MaterialProperty_a91841c6aad5",
        "label": "MaterialProperty",
        "type": "entity",
        "name": "Molecular Weight",
        "numeric_value": 450000.0,
        "unit": "g/mol"
      }
    },
    {
      "data": {
        "id": "MaterialProperty_3cf1f3d15c6c",
        "label": "MaterialProperty",
        "type": "entity",
        "name": "Molecular Weight",
        "numeric_value": 900000.0,
        "unit": "g/mol"
      }
    },
    {
      "data": {
        "id": "MaterialProperty_8fc5972b91b4",
        "label": "MaterialProperty",
        "type": "entity",
        "name": "Molecular Weight",
        "numeric_value": 1300000.0,
        "unit": "g/mol"
      }
    },
    {
      "data": {
        "id": "ComponentAmount_8369bf7cc2d1",
        "label": "ComponentAmount",
        "type": "entity",
        "name": "Weight Fraction",
        "numeric_value": 5.0,
        "unit": "wt%"
      }
    },
    {
      "data": {
        "id": "Component_361f680c5f29",
        "label": "Component",
        "type": "entity",
        "role": "Conductive Additive"
      }
    },
    {
      "data": {
        "id": "Material_cbcc9db8624c",
        "label": "Material",
        "type": "entity",
        "name": "Carbon Black",
        "category": "Additive",
        "chemical_formula": "C"
      }
    },
    {
      "data": {
        "id": "MaterialProperty_9e13409d4770",
        "label": "MaterialProperty",
        "type": "entity",
        "name": "Specific Surface Area",
        "numeric_value": 62.0,
        "unit": "m¬≤/g"
      }
    },
    {
      "data": {
        "id": "MaterialProperty_329c04379d5d",
        "label": "MaterialProperty",
        "type": "entity",
        "name": "Mean Particle Size",
        "numeric_value": 35.0,
        "unit": "nm"
      }
    },
    {
      "data": {
        "id": "ComponentAmount_925c6a7e3145",
        "label": "ComponentAmount",
        "type": "entity",
        "name": "Weight Fraction",
        "numeric_value": 4.0,
        "unit": "wt%"
      }
    },
    {
      "data": {
        "id": "Component_cdda50b461a8",
        "label": "Component",
        "type": "entity",
        "role": "Solvent"
      }
    },
    {
      "data": {
        "id": "Material_fe070cf7da30",
        "label": "Material",
        "type": "entity",
        "name": "N-Methyl-2-pyrrolidone",
        "category": "Solvent",
        "chemical_formula": "C5H9NO",
        "properties": "[]"
      }
    },
    {
      "data": {
        "id": "ComponentAmount_c431b26dea83",
        "label": "ComponentAmount",
        "type": "entity",
        "name": "Volume Fraction",
        "numeric_value": 80.0,
        "unit": "vol%"
      }
    },
    {
      "data": {
        "id": "Property_c7fc5935e7c1",
        "label": "Property",
        "type": "entity",
        "name": "Viscosity",
        "numeric_value": 1.0,
        "unit": "Pa.s",
        "condition": "at 50 1/s shear rate"
      }
    },
    {
      "data": {
        "id": "Property_d88386a0480e",
        "label": "Property",
        "type": "entity",
        "name": "Viscosity",
        "numeric_value": 10.8,
        "unit": "Pa.s",
        "condition": "at 50 1/s shear rate"
      }
    },
    {
      "data": {
        "id": "Property_daf0531e88d5",
        "label": "Property",
        "type": "entity",
        "name": "Viscosity",
        "numeric_value": 3.6,
        "unit": "Pa.s",
        "condition": "at 50 1/s shear rate"
      }
    },
    {
      "data": {
        "id": "Property_947c06a6d86c",
        "label": "Property",
        "type": "entity",
        "name": "Viscosity",
        "numeric_value": 1.9,
        "unit": "Pa.s",
        "condition": "at 50 1/s shear rate"
      }
    },
    {
      "data": {
        "id": "Property_1e8f6d076b6e",
        "label": "Property",
        "type": "entity",
        "name": "Viscosity",
        "numeric_value": 6.2,
        "unit": "Pa.s",
        "condition": "at 50 1/s shear rate"
      }
    },
    {
      "data": {
        "id": "ProcessStep_80b7b459ad4b",
        "label": "ProcessStep",
        "type": "entity",
        "name": "High-speed dry mixing",
        "step_type": "Mixing"
      }
    },
    {
      "data": {
        "id": "Parameter_1a3c3f0ae7a2",
        "label": "Parameter",
        "type": "entity",
        "name": "Speed",
        "numeric_value": 2800.0,
        "unit": "RPM"
      }
    },
    {
      "data": {
        "id": "Parameter_9a769df0ff0e",
        "label": "Parameter",
        "type": "entity",
        "name": "Duration",
        "numeric_value": 10.0,
        "unit": "min"
      }
    },
    {
      "data": {
        "id": "ProcessStep_9629b65e85d3",
        "label": "ProcessStep",
        "type": "entity",
        "name": "Vacuum equipped dissolver mixing",
        "step_type": "Mixing"
      }
    },
    {
      "data": {
        "id": "Parameter_a1440d9889c8",
        "label": "Parameter",
        "type": "entity",
        "name": "Speed",
        "numeric_value": 2000.0,
        "unit": "RPM"
      }
    },
    {
      "data": {
        "id": "Parameter_44a26cd106c6",
        "label": "Parameter",
        "type": "entity",
        "name": "Duration",
        "numeric_value": 30.0,
        "unit": "min"
      }
    },
    {
      "data": {
        "id": "EvaluationResult_5a31c5f8ed13",
        "label": "EvaluationResult",
        "type": "entity",
        "metric_type": "Viscosity",
        "method": "Rheometer (MCR 300, Paar Physica, Austria) with a plate-plate geometry (PP50, gap 1 mm) at a temperature of 25¬∞C",
        "trend": "Increasing"
      }
    },
    {
      "data": {
        "id": "EvaluationMetric_c7fc5935e7c1",
        "label": "EvaluationMetric",
        "type": "entity",
        "name": "Viscosity",
        "numeric_value": 1.0,
        "unit": "Pa.s",
        "condition": "at 50 1/s shear rate"
      }
    },
    {
      "data": {
        "id": "EvaluationResult_f104f3ea6cd9",
        "label": "EvaluationResult",
        "type": "entity",
        "metric_type": "Viscosity",
        "method": "Rheometer (MCR 300, Paar Physica, Austria) with a plate-plate geometry (PP50, gap 1 mm) at a temperature of 25¬∞C",
        "trend": "Increasing"
      }
    },
    {
      "data": {
        "id": "EvaluationMetric_d88386a0480e",
        "label": "EvaluationMetric",
        "type": "entity",
        "name": "Viscosity",
        "numeric_value": 10.8,
        "unit": "Pa.s",
        "condition": "at 50 1/s shear rate"
      }
    },
    {
      "data": {
        "id": "EvaluationResult_6aef49030442",
        "label": "EvaluationResult",
        "type": "entity",
        "metric_type": "Viscosity",
        "method": "Rheometer (MCR 300, Paar Physica, Austria) with a plate-plate geometry (PP50, gap 1 mm) at a temperature of 25¬∞C",
        "trend": "Increasing"
      }
    },
    {
      "data": {
        "id": "EvaluationMetric_daf0531e88d5",
        "label": "EvaluationMetric",
        "type": "entity",
        "name": "Viscosity",
        "numeric_value": 3.6,
        "unit": "Pa.s",
        "condition": "at 50 1/s shear rate"
      }
    },
    {
      "data": {
        "id": "EvaluationResult_76939dc1fdae",
        "label": "EvaluationResult",
        "type": "entity",
        "metric_type": "Viscosity",
        "method": "Rheometer (MCR 300, Paar Physica, Austria) with a plate-plate geometry (PP50, gap 1 mm) at a temperature of 25¬∞C",
        "trend": "Increasing"
      }
    },
    {
      "data": {
        "id": "EvaluationMetric_947c06a6d86c",
        "label": "EvaluationMetric",
        "type": "entity",
        "name": "Viscosity",
        "numeric_value": 1.9,
        "unit": "Pa.s",
        "condition": "at 50 1/s shear rate"
      }
    },
    {
      "data": {
        "id": "EvaluationResult_a736574e3563",
        "label": "EvaluationResult",
        "type": "entity",
        "metric_type": "Viscosity",
        "method": "Rheometer (MCR 300, Paar Physica, Austria) with a plate-plate geometry (PP50, gap 1 mm) at a temperature of 25¬∞C",
        "trend": "Increasing"
      }
    },
    {
      "data": {
        "id": "EvaluationMetric_1e8f6d076b6e",
        "label": "EvaluationMetric",
        "type": "entity",
        "name": "Viscosity",
        "numeric_value": 6.2,
        "unit": "Pa.s",
        "condition": "at 50 1/s shear rate"
      }
    }
  ],
  "edges": [
    {
      "data": {
        "source": "Research_a51e0d94f6fd",
        "target": "Extraction_d19c67115651",
        "label": "experiments",
        "id": "Research_a51e0d94f6fd-Extraction_d19c67115651-0"
      }
    },
    {
      "data": {
        "source": "Extraction_d19c67115651",
        "target": "Slurry_bdd079028ce8",
        "label": "slurry_under_test",
        "id": "Extraction_d19c67115651-Slurry_bdd079028ce8-1"
      }
    },
    {
      "data": {
        "source": "Extraction_d19c67115651",
        "target": "ProcessStep_80b7b459ad4b",
        "label": "fabrication_process",
        "id": "Extraction_d19c67115651-ProcessStep_80b7b459ad4b-2"
      }
    },
    {
      "data": {
        "source": "Extraction_d19c67115651",
        "target": "ProcessStep_9629b65e85d3",
        "label": "fabrication_process",
        "id": "Extraction_d19c67115651-ProcessStep_9629b65e85d3-3"
      }
    },
    {
      "data": {
        "source": "Extraction_d19c67115651",
        "target": "EvaluationResult_5a31c5f8ed13",
        "label": "evaluation_results",
        "id": "Extraction_d19c67115651-EvaluationResult_5a31c5f8ed13-4"
      }
    },
    {
      "data": {
        "source": "Extraction_d19c67115651",
        "target": "EvaluationResult_f104f3ea6cd9",
        "label": "evaluation_results",
        "id": "Extraction_d19c67115651-EvaluationResult_f104f3ea6cd9-5"
      }
    },
    {
      "data": {
        "source": "Extraction_d19c67115651",
        "target": "EvaluationResult_6aef49030442",
        "label": "evaluation_results",
        "id": "Extraction_d19c67115651-EvaluationResult_6aef49030442-6"
      }
    },
    {
      "data": {
        "source": "Extraction_d19c67115651",
        "target": "EvaluationResult_76939dc1fdae",
        "label": "evaluation_results",
        "id": "Extraction_d19c67115651-EvaluationResult_76939dc1fdae-7"
      }
    },
    {
      "data": {
        "source": "Extraction_d19c67115651",
        "target": "EvaluationResult_a736574e3563",
        "label": "evaluation_results",
        "id": "Extraction_d19c67115651-EvaluationResult_a736574e3563-8"
      }
    },
    {
      "data": {
        "source": "Slurry_bdd079028ce8",
        "target": "Component_1053de12e699",
        "label": "components",
        "id": "Slurry_bdd079028ce8-Component_1053de12e699-9"
      }
    },
    {
      "data": {
        "source": "Slurry_bdd079028ce8",
        "target": "Component_f0bd877e9fd7",
        "label": "components",
        "id": "Slurry_bdd079028ce8-Component_f0bd877e9fd7-10"
      }
    },
    {
      "data": {
        "source": "Slurry_bdd079028ce8",
        "target": "Component_93ebc76b3037",
        "label": "components",
        "id": "Slurry_bdd079028ce8-Component_93ebc76b3037-11"
      }
    },
    {
      "data": {
        "source": "Slurry_bdd079028ce8",
        "target": "Component_361f680c5f29",
        "label": "components",
        "id": "Slurry_bdd079028ce8-Component_361f680c5f29-12"
      }
    },
    {
      "data": {
        "source": "Slurry_bdd079028ce8",
        "target": "Component_cdda50b461a8",
        "label": "components",
        "id": "Slurry_bdd079028ce8-Component_cdda50b461a8-13"
      }
    },
    {
      "data": {
        "source": "Slurry_bdd079028ce8",
        "target": "Property_c7fc5935e7c1",
        "label": "properties",
        "id": "Slurry_bdd079028ce8-Property_c7fc5935e7c1-14"
      }
    },
    {
      "data": {
        "source": "Slurry_bdd079028ce8",
        "target": "Property_d88386a0480e",
        "label": "properties",
        "id": "Slurry_bdd079028ce8-Property_d88386a0480e-15"
      }
    },
    {
      "data": {
        "source": "Slurry_bdd079028ce8",
        "target": "Property_daf0531e88d5",
        "label": "properties",
        "id": "Slurry_bdd079028ce8-Property_daf0531e88d5-16"
      }
    },
    {
      "data": {
        "source": "Slurry_bdd079028ce8",
        "target": "Property_947c06a6d86c",
        "label": "properties",
        "id": "Slurry_bdd079028ce8-Property_947c06a6d86c-17"
      }
    },
    {
      "data": {
        "source": "Slurry_bdd079028ce8",
        "target": "Property_1e8f6d076b6e",
        "label": "properties",
        "id": "Slurry_bdd079028ce8-Property_1e8f6d076b6e-18"
      }
    },
    {
      "data": {
        "source": "Component_1053de12e699",
        "target": "Material_54ace0a45fc0",
        "label": "material",
        "id": "Component_1053de12e699-Material_54ace0a45fc0-19"
      }
    },
    {
      "data": {
        "source": "Component_1053de12e699",
        "target": "ComponentAmount_df05aab6a051",
        "label": "amount",
        "id": "Component_1053de12e699-ComponentAmount_df05aab6a051-20"
      }
    },
    {
      "data": {
        "source": "Material_54ace0a45fc0",
        "target": "MaterialProperty_ef8bb32df99b",
        "label": "properties",
        "id": "Material_54ace0a45fc0-MaterialProperty_ef8bb32df99b-21"
      }
    },
    {
      "data": {
        "source": "Material_54ace0a45fc0",
        "target": "MaterialProperty_ca16de11dfea",
        "label": "properties",
        "id": "Material_54ace0a45fc0-MaterialProperty_ca16de11dfea-22"
      }
    },
    {
      "data": {
        "source": "Material_54ace0a45fc0",
        "target": "MaterialProperty_a37aa557c0fa",
        "label": "properties",
        "id": "Material_54ace0a45fc0-MaterialProperty_a37aa557c0fa-23"
      }
    },
    {
      "data": {
        "source": "Component_f0bd877e9fd7",
        "target": "Material_edee1c86eb79",
        "label": "material",
        "id": "Component_f0bd877e9fd7-Material_edee1c86eb79-24"
      }
    },
    {
      "data": {
        "source": "Component_f0bd877e9fd7",
        "target": "ComponentAmount_df05aab6a051",
        "label": "amount",
        "id": "Component_f0bd877e9fd7-ComponentAmount_df05aab6a051-25"
      }
    },
    {
      "data": {
        "source": "Material_edee1c86eb79",
        "target": "MaterialProperty_fe980c39629e",
        "label": "properties",
        "id": "Material_edee1c86eb79-MaterialProperty_fe980c39629e-26"
      }
    },
    {
      "data": {
        "source": "Material_edee1c86eb79",
        "target": "MaterialProperty_b5aa0099fd4e",
        "label": "properties",
        "id": "Material_edee1c86eb79-MaterialProperty_b5aa0099fd4e-27"
      }
    },
    {
      "data": {
        "source": "Material_edee1c86eb79",
        "target": "MaterialProperty_a81d5a3454b1",
        "label": "properties",
        "id": "Material_edee1c86eb79-MaterialProperty_a81d5a3454b1-28"
      }
    },
    {
      "data": {
        "source": "Component_93ebc76b3037",
        "target": "Material_baff62f33661",
        "label": "material",
        "id": "Component_93ebc76b3037-Material_baff62f33661-29"
      }
    },
    {
      "data": {
        "source": "Component_93ebc76b3037",
        "target": "ComponentAmount_8369bf7cc2d1",
        "label": "amount",
        "id": "Component_93ebc76b3037-ComponentAmount_8369bf7cc2d1-30"
      }
    },
    {
      "data": {
        "source": "Material_baff62f33661",
        "target": "MaterialProperty_7313bdb1d9bc",
        "label": "properties",
        "id": "Material_baff62f33661-MaterialProperty_7313bdb1d9bc-31"
      }
    },
    {
      "data": {
        "source": "Material_baff62f33661",
        "target": "MaterialProperty_a91841c6aad5",
        "label": "properties",
        "id": "Material_baff62f33661-MaterialProperty_a91841c6aad5-32"
      }
    },
    {
      "data": {
        "source": "Material_baff62f33661",
        "target": "MaterialProperty_3cf1f3d15c6c",
        "label": "properties",
        "id": "Material_baff62f33661-MaterialProperty_3cf1f3d15c6c-33"
      }
    },
    {
      "data": {
        "source": "Material_baff62f33661",
        "target": "MaterialProperty_8fc5972b91b4",
        "label": "properties",
        "id": "Material_baff62f33661-MaterialProperty_8fc5972b91b4-34"
      }
    },
    {
      "data": {
        "source": "Component_361f680c5f29",
        "target": "Material_cbcc9db8624c",
        "label": "material",
        "id": "Component_361f680c5f29-Material_cbcc9db8624c-35"
      }
    },
    {
      "data": {
        "source": "Component_361f680c5f29",
        "target": "ComponentAmount_925c6a7e3145",
        "label": "amount",
        "id": "Component_361f680c5f29-ComponentAmount_925c6a7e3145-36"
      }
    },
    {
      "data": {
        "source": "Material_cbcc9db8624c",
        "target": "MaterialProperty_9e13409d4770",
        "label": "properties",
        "id": "Material_cbcc9db8624c-MaterialProperty_9e13409d4770-37"
      }
    },
    {
      "data": {
        "source": "Material_cbcc9db8624c",
        "target": "MaterialProperty_329c04379d5d",
        "label": "properties",
        "id": "Material_cbcc9db8624c-MaterialProperty_329c04379d5d-38"
      }
    },
    {
      "data": {
        "source": "Component_cdda50b461a8",
        "target": "Material_fe070cf7da30",
        "label": "material",
        "id": "Component_cdda50b461a8-Material_fe070cf7da30-39"
      }
    },
    {
      "data": {
        "source": "Component_cdda50b461a8",
        "target": "ComponentAmount_c431b26dea83",
        "label": "amount",
        "id": "Component_cdda50b461a8-ComponentAmount_c431b26dea83-40"
      }
    },
    {
      "data": {
        "source": "ProcessStep_80b7b459ad4b",
        "target": "Parameter_1a3c3f0ae7a2",
        "label": "parameters",
        "id": "ProcessStep_80b7b459ad4b-Parameter_1a3c3f0ae7a2-41"
      }
    },
    {
      "data": {
        "source": "ProcessStep_80b7b459ad4b",
        "target": "Parameter_9a769df0ff0e",
        "label": "parameters",
        "id": "ProcessStep_80b7b459ad4b-Parameter_9a769df0ff0e-42"
      }
    },
    {
      "data": {
        "source": "ProcessStep_9629b65e85d3",
        "target": "Parameter_a1440d9889c8",
        "label": "parameters",
        "id": "ProcessStep_9629b65e85d3-Parameter_a1440d9889c8-43"
      }
    },
    {
      "data": {
        "source": "ProcessStep_9629b65e85d3",
        "target": "Parameter_44a26cd106c6",
        "label": "parameters",
        "id": "ProcessStep_9629b65e85d3-Parameter_44a26cd106c6-44"
      }
    },
    {
      "data": {
        "source": "EvaluationResult_5a31c5f8ed13",
        "target": "EvaluationMetric_c7fc5935e7c1",
        "label": "metric",
        "id": "EvaluationResult_5a31c5f8ed13-EvaluationMetric_c7fc5935e7c1-45"
      }
    },
    {
      "data": {
        "source": "EvaluationResult_f104f3ea6cd9",
        "target": "EvaluationMetric_d88386a0480e",
        "label": "metric",
        "id": "EvaluationResult_f104f3ea6cd9-EvaluationMetric_d88386a0480e-46"
      }
    },
    {
      "data": {
        "source": "EvaluationResult_6aef49030442",
        "target": "EvaluationMetric_daf0531e88d5",
        "label": "metric",
        "id": "EvaluationResult_6aef49030442-EvaluationMetric_daf0531e88d5-47"
      }
    },
    {
      "data": {
        "source": "EvaluationResult_76939dc1fdae",
        "target": "EvaluationMetric_947c06a6d86c",
        "label": "metric",
        "id": "EvaluationResult_76939dc1fdae-EvaluationMetric_947c06a6d86c-48"
      }
    },
    {
      "data": {
        "source": "EvaluationResult_a736574e3563",
        "target": "EvaluationMetric_1e8f6d076b6e",
        "label": "metric",
        "id": "EvaluationResult_a736574e3563-EvaluationMetric_1e8f6d076b6e-49"
      }
    }
  ],
  "meta": {
    "node_types": {
      "Research": 1,
      "Extraction": 1,
      "Slurry": 1,
      "Component": 5,
      "Material": 5,
      "MaterialProperty": 12,
      "ComponentAmount": 4,
      "Property": 5,
      "ProcessStep": 2,
      "Parameter": 4,
      "EvaluationResult": 5,
      "EvaluationMetric": 5
    },
    "node_count": 50,
    "edge_count": 50
  }
};
        // The Python script will replace the placeholder line above with:
        // const graphElements = { ... your data ... };
        
        // Fallback for standalone preview (if placeholder isn't replaced)
        if (typeof graphElements === 'undefined') {
          console.warn("graphElements not injected by Python. Using sample data.");
          // Use window scope to make it available globally like the injected const
          window.graphElements = {
              "nodes": [
                  { "data": { "id": "n1", "label": "Person", "name": "Alice" } },
                  { "data": { "id": "n2", "label": "Person", "name": "Bob" } },
                  { "data": { "id": "n3", "label": "Company", "name": "Innovate Inc." } }
              ],
              "edges": [
                  { "data": { "id": "e1", "source": "n1", "target": "n2", "label": "KNOWS" } },
                  { "data": { "id": "e2", "source": "n1", "target": "n3", "label": "WORKS_AT" } },
                  { "data": { "id": "e3", "source": "n2", "target": "n3", "label": "WORKS_AT" } }
              ],
              "meta": {
                  "node_types": { "Person": 2, "Company": 1 },
                  "node_count": 3,
                  "edge_count": 3
              }
          };
        }
        /* END ELEMENTS_DATA_PLACEHOLDER */


        /* Generate color per node label */
        const NODE_COLOR_PALETTE = [
            '#4e79a7', '#f28e2c', '#e15759', '#76b7b2', '#59a14f', 
            '#edc949', '#af7aa1', '#ff9da7', '#9c755f', '#bab0ab'
        ];
        const labelColorMap = new Map();
        let colorIndex = 0;

        function stringToColor(str) {
          const key = String(str);
          if (labelColorMap.has(key)) {
            return labelColorMap.get(key);
          }

          // Assign the next color from the palette
          const color = NODE_COLOR_PALETTE[colorIndex % NODE_COLOR_PALETTE.length];
          labelColorMap.set(key, color);
          colorIndex++;
          return color;
        }

        /* Count by label, with fallbacks */
        function calculateNodeTypeStats(elements) {
          const counts = {};
          (elements.nodes || []).forEach(node => {
            const d = node.data || {};
            let labels = [];
            if (Array.isArray(d.labels)) {
              labels = d.labels.map(String).filter(Boolean);
            } else if (typeof d.labels === 'string') {
              const parts = d.labels.split(/[|,]/).map(s => s.trim()).filter(Boolean);
              if (parts.length) labels = parts;
              else if (d.labels.includes(':') && !d.labels.trim().startsWith('http')) {
                labels = d.labels.split(':').filter(Boolean);
              } else {
                labels = [d.labels];
              }
            }
            if (labels.length) {
              labels.forEach(l => { counts[l] = (counts[l] || 0) + 1; });
              return;
            }
            const key = d.label || d.node_label || d.node_type || d.type || d.category || d.class || d.kind || 'Unknown';
            counts[key] = (counts[key] || 0) + 1;
          });
          return counts;
        }

        // Display node type statistics
        function displayNodeTypeStats(nodeTypes) {
            const nodeTypesList = document.getElementById('node-types-list');
            const sortedTypes = Object.entries(nodeTypes).sort((a, b) => b[1] - a[1]);

            nodeTypesList.innerHTML = sortedTypes.map(([type, count]) => {
                // Use the 'Unknown' key for the default color if type is null/undefined
                const colorKey = type === 'null' || type === 'undefined' ? 'Unknown' : type;
                const color = stringToColor(String(colorKey));
                
                // This is the part that creates the colored circle legend
                return `<div class="node-type-item" style="display: flex; align-items: center; margin-bottom: 4px;">
                            <span style="background-color: ${color}; width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 8px; flex-shrink: 0;"></span>
                            <span>${type} - ${count}</span>
                        </div>`;
            }).join('');
        }

        // Initialize Cytoscape
        const cy = cytoscape({
            container: document.getElementById('cy'),
            elements: graphElements,
            style: [
                {
                    selector: 'node',
                    style: {
                        // --- Node Body Styling ---
                        'background-color': function(ele) {
                          const key = ele.data('label') || ele.data('type') || 'Unknown';
                          return stringToColor(String(key));
                        },
                        'width': 60,
                        'height': 60,
                        'border-width': 0, // No border by default
                        'border-color': 'rgba(255,255,255,0.7)',
                        
                        // --- Label Styling ---                        
                        'label': 'data(label)',
                        'color': function(ele) {
                          const key = ele.data('label') || ele.data('type') || 'Unknown';
                          return stringToColor(String(key));
                        },
                        'text-valign': 'top',
                        'text-halign': 'center',
                        'text-margin-y': -12, // Move label up a bit more to clear the node
                        'font-size': '10px',
                        'font-weight': 'bold',

                        // --- Label Background Box ---
                        'text-background-color': '#1e2428',
                        'text-background-shape': 'round-rectangle', // Rounded edges
                        'text-background-padding': '4px', // Padding inside the box
                        'text-background-opacity': 0.75, // Make background solid
                    }
                },
                {
                    selector: 'node:selected',
                    style: {
                        'border-width': 6, // Larger border width
                        'border-color': 'white', // White border
                        'border-style': 'double' // Creates "padding" effect
                    }
                },
                {
                    selector: 'node:active',
                    style: {
                        'overlay-opacity': 0
                    }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 1, // Thinner line
                        'line-color': 'rgba(255, 255, 255, 0.2)', // Muted color
                        'target-arrow-shape': 'none', // No arrows
                        'curve-style': 'bezier',
                        'opacity': 0.6,
                        'transition-property': 'line-color, width, opacity',
                        'transition-duration': '0.3s'
                        // --- Edge Label Styling (REMOVED) ---
                    }
                },
                {
                    selector: 'edge:selected',
                    style: {
                        'line-color': '#76b7b2',
                        'width': 3,
                        'opacity': 1
                    }
                },
                // Highlighted elements (when node is clicked)
                {
                    selector: '.highlighted',
                    style: {
                        'opacity': 1,
                        'z-index': 997
                    }
                },
                // Faded elements (when highlighting)
                {
                    selector: '.faded',
                    style: {
                        'opacity': 0.15
                    }
                }
            ],
            layout: {
                name: 'dagre',
                rankDir: 'TB',
                nodeSep: 50,
                rankSep: 100,
                padding: 30
            },
            minZoom: 0.1,
            maxZoom: 3,
            wheelSensitivity: 0.2
        });

        // Add cursor pointer style to canvas when hovering nodes
        cy.on('mouseover', 'node', function(evt) {
            document.getElementById('cy').style.cursor = 'pointer';
        });

        cy.on('mouseout', 'node', function(evt) {
            document.getElementById('cy').style.cursor = 'default';
        });

        // Add cursor pointer style to canvas when hovering edges
        cy.on('mouseover', 'edge', function(evt) {
            document.getElementById('cy').style.cursor = 'pointer';
        });

        cy.on('mouseout', 'edge', function(evt) {
            document.getElementById('cy').style.cursor = 'default';
        });

        /* Update stats */
        const meta = graphElements.meta || {};
        document.getElementById('node-count').textContent = (meta.node_count != null) ? meta.node_count : cy.nodes().length;
        document.getElementById('edge-count').textContent = (meta.edge_count != null) ? meta.edge_count : cy.edges().length;

        /* Prefer Python-provided meta, fallback to client-side calc */
        const nodeTypeStats = (meta.node_types && Object.keys(meta.node_types).length)
          ? meta.node_types
          : calculateNodeTypeStats(graphElements);

        displayNodeTypeStats(nodeTypeStats);

        // Hide loading
        document.getElementById('loading').classList.remove('active');

        // Layout selector
        document.getElementById('layout-select').addEventListener('change', function(e) {
            const layoutName = e.target.value;
            let layoutOptions = { name: layoutName };

            if (layoutName === 'dagre') {
                layoutOptions = {
                    name: 'dagre',
                    rankDir: 'TB',
                    nodeSep: 50,
                    rankSep: 100,
                    padding: 30
                };
            } else if (layoutName === 'cose') {
                layoutOptions = {
                    name: 'cose',
                    animate: true,
                    animationDuration: 1000,
                    nodeRepulsion: 8000,
                    idealEdgeLength: 100,
                    edgeElasticity: 100,
                    nestingFactor: 5,
                    gravity: 80,
                    numIter: 1000,
                    padding: 30
                };
            } else if (layoutName === 'breadthfirst') {
                layoutOptions = {
                    name: 'breadthfirst',
                    directed: true,
                    spacingFactor: 1.5,
                    padding: 30
                };
            } else {
                layoutOptions = {
                    name: layoutName,
                    padding: 30
                };
            }

            cy.layout(layoutOptions).run();
        });

        // Reset view button
        document.getElementById('reset-btn').addEventListener('click', function() {
            cy.fit(undefined, 20);
            cy.center();
        });

        // Node click handler - show details and highlight
        cy.on('tap', 'node', function(evt) {
            const node = evt.target;
            const data = node.data();

            // Highlight neighbors
            cy.elements().removeClass('highlighted faded');
            const neighborhood = node.neighborhood().add(node);
            cy.elements().addClass('faded');
            neighborhood.removeClass('faded').addClass('highlighted');

            // Show info panel
            const infoPanel = document.getElementById('info-panel');
            const infoContent = document.getElementById('info-content');

            let html = '<div style="margin-bottom: 8px; font-weight: 600; color: #e2e8f0;">üìç Node Details</div>';
            for (const [key, value] of Object.entries(data)) {
                if (value != null && value !== '') {
                    const displayValue = String(value).length > 100 
                        ? String(value).substring(0, 100) + '...' 
                        : value;
                    html += `<div class="info-item"><span class="info-label">${key}:</span> ${displayValue}</div>`;
                }
            }

            infoContent.innerHTML = html;
            infoPanel.classList.add('active');
        });

        // Edge click handler - show details and highlight
        cy.on('tap', 'edge', function(evt) {
            const edge = evt.target;
            const data = edge.data();

            cy.elements().removeClass('highlighted faded');
            cy.elements().addClass('faded');

            edge.removeClass('faded').addClass('highlighted');
            edge.source().removeClass('faded').addClass('highlighted');
            edge.target().removeClass('faded').addClass('highlighted');

            // Show edge info
            const infoPanel = document.getElementById('info-panel');
            const infoContent = document.getElementById('info-content');

            let html = '<div style="margin-bottom: 8px; font-weight: 600; color: #e2e8f0;">üîó Edge Details</div>';
            html += `<div class="info-item"><span class="info-label">From:</span> ${data.source}</div>`;
            html += `<div class="info-item"><span class="info-label">To:</span> ${data.target}</div>`;

            for (const [key, value] of Object.entries(data)) {
                if (value != null && value !== '' && key !== 'source' && key !== 'target' && key !== 'id') {
                    const displayValue = String(value).length > 100 
                        ? String(value).substring(0, 100) + '...' 
                        : value;
                    html += `<div class="info-item"><span class="info-label">${key}:</span> ${displayValue}</div>`;
                }
            }

            infoContent.innerHTML = html;
            infoPanel.classList.add('active');
        });

        // Click on background - clear highlights
        cy.on('tap', function(evt) {
            if (evt.target === cy) {
                cy.elements().removeClass('highlighted faded');
                document.getElementById('info-panel').classList.remove('active');
            }
        });

        // Fit graph to view on load
        cy.ready(function() {
            cy.fit(undefined, 20);
            cy.center();
        });
    </script>
</body>
</html>

